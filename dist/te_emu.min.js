"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Command=function(){function e(t,n){var o=this,a=n.defaultFx,r=void 0===a?function(){o.flat?o.console.output("Command is flat; no operations attached"):(o.console.output("Available Operations:"),o.console.output(Object.keys(o.operations).join(", ")))}:a,i=n.flat,s=void 0===i?!1:i;_classCallCheck(this,e),this["default"]=r,this.flat=Boolean(s),this.console=t}return _createClass(e,[{key:"addOperation",value:function(t){var n=this,o=t.key,a=t.fx,r=t.format,i=t.flags;this.flat?console.error("Command is flat"):e.validateOp({key:o,fx:a,format:r,flags:i})&&("operations"in this||(this.operations={}),this.operations[o]={fx:a,format:r,help:function(){n.console.output(["Operation syntax:",r+"\r\n"+"-".repeat(24),"Available flags:"]);var e=[];for(var t in n.operations[o].flags)e.push(t+" ".repeat(24-t.length)+n.operations[o].flags[t]);n.console.output(e)},flags:i})}},{key:"invoke",value:function(e){var t=e.key,n=e.args,o=e.flags;t&&this.operations[t]?o.indexOf("-h")>-1||o.indexOf("--help")>-1?this.operations[t].help():this.operations[t].fx.call(this,n,o):this["default"].call(this,n,o)}}],[{key:"validate",value:function(e){var t=e.key,n=e.defaultFx;if("string"!=typeof t)console.error("Invalid: key not of type String");else{if("undefined"==typeof n||"function"==typeof n)return!0;console.error("Invalid: defaultFx not a Function")}return!1}},{key:"validateOp",value:function(e){var t=e.key,n=e.fx,o=(e.format,e.flags);if("string"!=typeof t)console.error("Invalid: key not of type String");else{if(n instanceof Function){if(o&&o instanceof Object&&!(o instanceof Array)){for(var a in o){if(!/^-{1,2}/.test(a))return console.error("all flags start with either - or --"),!1;if(/^-h$|^--help$/.test(a))return console.error("-h and --help are reserved"),!1}return!0}return!0}console.error("Invalid: fx not a Function")}return!1}}]),e}(),TE_EMU_DEFAULTS={commandLine:[".teemu-cl","#teemu-cl"],dialogWrapper:"code",windows:[".teemu-window","#teemu-window"],prefix:"[user@te_emu ~]$ ",defaultCommands:{clear:new Command(void 0,{defaultFx:function(){(void 0).clear()},flat:!0})}},Te_emu=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e),this.options=e.extend(TE_EMU_DEFAULTS,t),this.commands=this.options.defaultCommands;for(var n=document.querySelectorAll(this.options.commandLine.join()),o=this,a=0;a<n.length;a++)n[a].addEventListener("keypress",function(e){13===e.which&&(o.output(o.options.prefix+this.value),o.parse(this.value),this.value="")})}return _createClass(e,[{key:"addCommand",value:function(e){!(e instanceof Object)||e instanceof Array?console.error("addCommand: type Object expected; type "+("undefined"==typeof e?"undefined":_typeof(e))+" received"):Command.validate(e)&&(this.commands[e.key]=new Command(this,e))}},{key:"parse",value:function(e){var t=e.split(" "),n=t.shift();if(!this.commands[n])return void this.output(n+": command not found");if(!this.commands[n].flat)var o=t.shift();for(var a=[],r=[],i=0;i<t.length;i++)/^-{1,2}/.test(t[i])?a.push(t[i]):r.push(t[i]);this.commands[n].invoke({key:o,flags:a,args:r})}},{key:"output",value:function(e){if("string"==typeof e)var e=[e];for(var t=document.querySelectorAll(this.options.windows.join()),n=0;n<e.length;n++){var o=document.createElement(this.options.dialogWrapper),a=document.createTextNode(e[n]);o.appendChild(a);for(var r=0;r<t.length;r++)t[r].insertAdjacentHTML("beforeend",o.outerHTML)}}},{key:"clear",value:function(){for(var e=document.querySelectorAll(this.options.windows.join()),t=0;t<e.length;t++)e[t].innerHTML=""}}],[{key:"extend",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){for(var n in e)t.hasOwnProperty(n)&&(t[n]instanceof Object&&!(t[n]instanceof Array)?extend(e[n],t[n]):e[n]=t[n]);return e})}]),e}();