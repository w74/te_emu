"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Command=function(){function e(t,n){var o=n.defaultFx,a=void 0===o?function(){this.flat?this.console._output("Command is flat; no subcommands attached"):(this.console._output("Available Subcommands:"),this.console._output(Object.keys(this.subs).join(", ")))}:o,r=n.flat,i=void 0===r?!1:r;_classCallCheck(this,e),this["default"]=a,this.flat=Boolean(i),this.console=t}return _createClass(e,[{key:"addSub",value:function(t){var n=t.key,o=t.fx,a=t.format,r=t.flags,i=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];this.flat?console.error("Command is flat"):e.validateSub({key:n,fx:o,format:a,flags:r})&&("subs"in this||(this.subs={}),this.subs[n]&&!i?console.error("Subcommand already exists"):this.subs[n]={fx:o,format:a,flags:r,help:function(){var e=[];a&&e.push("Command syntax:",a,"-".repeat(24)),e.push("Available flags:");for(var t in r)e.push(t+" ".repeat(24-t.length)+r[t]);this.console._output(e)}})}},{key:"_invoke",value:function(e){var t=e.key,n=e.args,o=e.flags;t&&this.subs[t]?o.indexOf("-h")>-1||o.indexOf("--help")>-1?this.subs[t].help.call(this):this.subs[t].fx.call(this,n,o):this["default"].call(this,n,o)}}],[{key:"validate",value:function(e){var t=e.key,n=e.defaultFx;if("string"!=typeof t)console.error("Invalid: key not of type String");else{if("undefined"==typeof n||"function"==typeof n)return!0;console.error("Invalid: defaultFx not a Function")}return!1}},{key:"validateSub",value:function(e){var t=e.key,n=e.fx,o=(e.format,e.flags);if("string"!=typeof t)console.error("Invalid: key not of type String");else{if(n instanceof Function){if(o&&o instanceof Object&&!(o instanceof Array)){for(var a in o){if(!/^-{1,2}[a-zA-Z0-9]+/.test(a))return console.error("flags must start with - or -- and be at least one alphanumeric character long"),!1;if(/^-h$|^--help$/.test(a))return console.error("-h and --help are reserved"),!1}return!0}return!0}console.error("Invalid: fx not a Function")}return!1}}]),e}(),TE_EMU_DEFAULTS={commandLine:[".teemu-cl","#teemu-cl"],outputEl:"code",windows:[".teemu-window","#teemu-window"],prompt:"$",defaultCommands:{clear:new Command(void 0,{defaultFx:function(){(void 0).clear()},flat:!0})}},Te_emu=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e),this.options=e.extend(TE_EMU_DEFAULTS,t),this.commands=this.options.defaultCommands;for(var n=document.querySelectorAll(this.options.commandLine.join()),o=this,a=0;a<n.length;a++)n[a].addEventListener("keypress",function(e){13===e.which&&(o._output(o.options.prompt+" "+this.value),o._parse(this.value),this.value="")})}return _createClass(e,[{key:"cmd",value:function(e){return Boolean(this.commands[e])?this.commands[e]:!1}},{key:"addCommand",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];!(e instanceof Object)||e instanceof Array?console.error("addCommand: type Object expected; type "+("undefined"==typeof e?"undefined":_typeof(e))+" received"):this.commands[e.key]&&!t?console.error("Command already exists"):Command.validate(e)&&(this.commands[e.key]=new Command(this,e))}},{key:"_parse",value:function(e){var t=e.split(" "),n=t.shift();if(!this.commands[n])return void this._output(n+": command not found");if(!this.commands[n].flat)var o=t.shift();for(var a=[],r=[],i=0;i<t.length;i++)/^-{1,2}/.test(t[i])?a.push(t[i]):r.push(t[i]);this.commands[n]._invoke({key:o,flags:a,args:r})}},{key:"_output",value:function(e){if("string"==typeof e)var e=[e];for(var t=document.querySelectorAll(this.options.windows.join()),n=0;n<e.length;n++){var o=document.createElement(this.options.outputEl),a=document.createTextNode(e[n]);o.appendChild(a);for(var r=0;r<t.length;r++)t[r].insertAdjacentHTML("beforeend",o.outerHTML)}}},{key:"clear",value:function(){for(var e=document.querySelectorAll(this.options.windows.join()),t=0;t<e.length;t++)e[t].innerHTML=""}}],[{key:"extend",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){for(var n in e)t.hasOwnProperty(n)&&(t[n]instanceof Object&&!(t[n]instanceof Array)?extend(e[n],t[n]):e[n]=t[n]);return e})}]),e}();